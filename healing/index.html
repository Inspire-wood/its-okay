<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personalized Healing Landing</title>
  <style>
    :root{ --overlay-bg: rgba(255,255,255,.84); --text-dark:#2c3e50; }
    *{box-sizing:border-box}
    body{ margin:0; padding:0; font-family: system-ui, -apple-system, "Helvetica Neue", Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif; min-height:100vh; display:flex; align-items:center; justify-content:center; background-size:cover; background-position:center; background-repeat:no-repeat; transition: background-image 800ms ease-in-out; color:#3c2f2f; text-align:center; background-image: linear-gradient(135deg,#fefefe,#f1f1f4); }
    .overlay{ width:min(92vw, 640px); background:var(--overlay-bg); border-radius:24px; padding:40px 28px; box-shadow:0 10px 30px rgba(0,0,0,.18); backdrop-filter: blur(4px); }
    h1{font-size: clamp(28px, 4vw, 42px); margin:0 0 8px; letter-spacing: .2px}
    h2{font-weight:400; font-size: clamp(16px, 2.4vw, 20px); margin:0 0 28px; color:#5b5b5b}
    .message{font-size: clamp(18px, 2.6vw, 22px); font-weight:700; color:var(--text-dark)}
    .meta{margin-top:18px; font-size:13px; color:#6b6b6b}
  </style>
</head>
<body>
  <div class="overlay">
    <h1 id="title">Welcome</h1>
    <h2 id="subtitle">당신의 오늘이 따뜻하길</h2>
    <div class="message" id="message">…</div>
    <div class="meta" id="meta"></div>
  </div>
  <script>
    const params = new URLSearchParams(location.search);
    const nameParam = params.get('name');
    const modeParam = params.get('mode') || 'daily';
    const DATA = {"defaultName":"Grace","greetings":{"title":"Welcome to {name}","subtitle":"{name}, 오늘이 따뜻하길"},"items":[{"text":"{name} A","bg":"https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1920&q=80"},{"text":"{name} B","bg":"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1920&q=80"}]};
    DATA.items = [{"text":"{name} A","bg":"https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1920&q=80"},{"text":"{name} B","bg":"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1920&q=80"}];

    const $ = (id) => document.getElementById(id);
    function personalize(str, name){ return (str||'').replaceAll('{name}', name); }
    function dailyIndex(len){
      if(!len || len<=0) return 0;
      const now = new Date();
      const y = now.getFullYear();
      const m = now.getMonth()+1;
      const d = now.getDate();
      const seed = (y*10000)+(m*100)+d; // 안전한 산술 결합
      return seed % len;
    }
    function randIndex(len){ return Math.floor(Math.random()*Math.max(1,len)); }

    function applyBackground(url){
      if(!url) return; // gradient fallback stays
      const img = new Image();
      img.onload = function(){ document.body.style.backgroundImage = 'url(' + url + ')'; };
      img.onerror = function(){ /* keep gradient */ };
      img.src = url;
    }

    (function init(){
      const name = (nameParam && nameParam.trim()) || DATA.defaultName || 'Grace';
      document.title = personalize((DATA.greetings?.title || 'Welcome to {name}'), name);
      $('title').textContent = personalize((DATA.greetings?.title || 'Welcome to {name}'), name);
      $('subtitle').textContent = personalize((DATA.greetings?.subtitle || '{name}, 오늘이 따뜻하길'), name);

      const items = (DATA.items && DATA.items.length) ? DATA.items : [];
      let pick = null;
      if(items.length){
        pick = (modeParam==='daily') ? items[dailyIndex(items.length)] : items[randIndex(items.length)];
        $('message').textContent = personalize((pick && pick.text) || '', name);
        applyBackground(pick && pick.bg);
      }else{
        $('message').textContent = '메시지를 등록해주세요.';
      }

      const today = new Date();
      const ymd = today.toLocaleDateString('ko-KR', {year:'numeric', month:'long', day:'numeric'});
      const used = (pick && pick.bg) ? pick.bg : 'gradient-fallback';
      $('meta').textContent = ymd + ' · ' + (modeParam==='daily' ? '일일 고정' : '랜덤 표시') + ' · 배경: ' + used;
    })();
  </script>
</body>
</html>