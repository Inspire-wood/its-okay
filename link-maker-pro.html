<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Link Maker PRO — Inspire‑wood</title>
<meta name="theme-color" content="#111111">
<style>
  :root{
    --maxw: 1040px; --radius: 16px; --shadow: 0 12px 36px rgba(0,0,0,.08);
    --muted:#666;
  }
  *{ box-sizing: border-box }
  html,body{ margin:0; padding:0; }
  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial, sans-serif;
    background:
      radial-gradient(1000px 700px at 20% 10%, rgba(255,219,219,.5), transparent 60%),
      radial-gradient(800px 600px at 80% 20%, rgba(204,232,255,.45), transparent 60%),
      radial-gradient(900px 800px at 50% 100%, rgba(215,255,224,.45), transparent 60%),
      #f7f8fb;
    color:#111; line-height:1.55;
  }
  .wrap{ padding: clamp(16px, 4vw, 40px); display:flex; justify-content:center }
  .container{ width:100%; max-width: var(--maxw); display:grid; gap: 16px }
  header{ display:flex; align-items:baseline; gap: 12px; flex-wrap:wrap }
  h1{ margin:0; font-size: clamp(22px, 3.6vw, 32px) }
  .sub{ color: var(--muted); font-size: 13px }
  .grid{ display:grid; grid-template-columns: 1fr; gap:16px }
  @media (min-width: 980px){ .grid{ grid-template-columns: 1.2fr 1fr; } }
  .card{ background:#fff; border-radius: var(--radius); box-shadow: var(--shadow); padding: clamp(16px, 2.8vw, 28px); }
  label{ font-size: 14px; font-weight:600; display:block; margin-bottom: 6px }
  input[type="text"], input[type="url"]{
    width:100%; padding:12px 12px; border-radius: 12px; border:1px solid #ddd; font-size:16px;
  }
  .row{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
  .btn{ padding:10px 14px; border-radius: 12px; border:1px solid #ddd; background:#fff; cursor:pointer; font-size:14px }
  .btn.primary{ background:#111; color:#fff; border-color:#111 }
  .btn.ghost{ background:#f7f7f7 }
  .small{ font-size:12px; color:#777 }
  .out{ background:#fff; border-radius: 12px; border:1px dashed #ddd; padding:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; word-break: break-all; }
  .qr{ display:flex; flex-direction:column; align-items:center; gap:12px }
  .qr img{ width: 240px; height: 240px; border-radius: 8px; background: #fff; }
  .actions{ display:flex; flex-wrap:wrap; gap:10px }
  .toggle{ display:flex; align-items:center; gap:8px; font-size:13px; color:#333 }
  .suggest{ margin-top:14px }
  .suggest .head{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px }
  .suggest .list{
    max-height: 260px; overflow:auto; border:1px solid #eee; border-radius:12px; padding:6px; background:#fafafa;
  }
  .suggest button.item{
    width:100%; text-align:left; padding:10px 12px; border-radius:10px; border:1px solid transparent; background:transparent; cursor:pointer; font-size:14px
  }
  .suggest button.item:hover{ background:#fff; border-color:#ddd }
</style>
</head>
<body>
  <div class="wrap">
    <div class="container">
      <header>
        <h1>Link&nbsp;Maker PRO</h1>
        <div class="sub">문장 넣으면 URL/QR 자동 생성 + 발음 자동 + 영어 의미 추천</div>
      </header>

      <section class="grid">
        <article class="card">
          <div class="row">
            <div>
              <label for="base">Base URL</label>
              <input type="url" id="base" value="https://inspire-wood.github.io/its-okay/">
              <div class="small">보통 수정할 필요 없음</div>
            </div>
            <button class="btn" id="reset">기본값</button>
          </div>

          <div style="height:8px"></div>
          <label for="ko">한국어</label>
          <input type="text" id="ko" placeholder="예: 괜찮아 / 고마워 / 사랑해">

          <div style="height:8px"></div>
          <div class="row">
            <div>
              <label for="roman">한국어 발음 (영문)</label>
              <input type="text" id="roman" placeholder="자동 생성됨 — 필요시 수정">
              <div class="small">하이픈은 줄바꿈 방지하이픈(‑) 자동 적용</div>
            </div>
            <div class="toggle"><input type="checkbox" id="auto" checked><label for="auto">발음 자동</label></div>
          </div>

          <div style="height:8px"></div>
          <div class="row">
            <div>
              <label for="en">영어 의미</label>
              <input type="text" id="en" placeholder="추천 목록에서 선택하거나 직접 입력">
            </div>
            <button class="btn" id="toupper">영문 대문자</button>
          </div>

          <div class="suggest">
            <div class="head">
              <div style="font-weight:700">영어 의미 추천</div>
              <button class="btn ghost" id="refreshSuggest">새로고침</button>
            </div>
            <div class="list" id="suggestList" aria-label="영어 의미 추천 목록"></div>
          </div>

          <div style="height:16px"></div>
          <div class="actions">
            <button class="btn primary" id="build">URL 생성</button>
            <button class="btn" id="copy">URL 복사</button>
            <a class="btn" id="open" target="_blank" rel="noopener">새 창에서 열기</a>
          </div>

          <div style="height:10px"></div>
          <div class="out" id="out">여기에 결과 URL이 표시됩니다</div>
        </article>

        <aside class="card qr">
          <div style="font-weight:700">QR 코드</div>
          <img id="qr" alt="QR preview">
          <div class="actions">
            <a class="btn" id="download" download="qr.png">QR 다운로드</a>
            <button class="btn ghost" id="refresh">QR 새로고침</button>
          </div>
          <div class="small">QR은 quickchart.io 이미지를 사용합니다.</div>
        </aside>
      </section>
    </div>
  </div>

<script>
  const $ = (s)=>document.querySelector(s);
  const nonbreak = '\u2011'; // NB hyphen

  // Revised Romanization base maps
  const CHO = ["g","kk","n","d","tt","r","m","b","pp","s","ss","","j","jj","ch","k","t","p","h"];
  const JUNG = ["a","ae","ya","yae","eo","e","yeo","ye","o","wa","wae","oe","yo","u","wo","we","wi","yu","eu","ui","i"];
  const JONG = ["","k","k","ks","n","nj","nh","t","l","lg","lm","lb","ls","lt","lp","lh","m","p","ps","t","t","ng","t","t","k","t","p","t"];

  // Preferred roman overrides for common phrases
  const PREFERRED = {
    "괜찮아": "gwen‑cha‑na",
    "고마워": "go‑ma‑wo",
    "사랑해": "sa‑rang‑hae",
    "미안해": "mi‑an‑hae",
    "감사해": "gam‑sa‑hae",
    "감사합니다": "gam‑sa‑ham‑ni‑da",
    "축하해": "chuk‑ha‑hae",
    "잘 했어": "jal‑haet‑seo",
    "잘했어": "jal‑haet‑seo",
    "힘내": "him‑nae",
    "안녕": "an‑nyeong"
  };

  // English suggestion dictionary
  const SUGG = [
    { ko: "괜찮아", en: ["IT’S OKAY","I’M OKAY","I’M FINE","NO WORRIES","THAT’S FINE","ALL GOOD"] },
    { ko: "고마워", en: ["THANK YOU","THANKS","MUCH APPRECIATED"] },
    { ko: "감사해", en: ["THANK YOU","MUCH APPRECIATED"] },
    { ko: "감사합니다", en: ["THANK YOU","MUCH APPRECIATED"] },
    { ko: "사랑해", en: ["I LOVE YOU","LOVE YOU"] },
    { ko: "미안해", en: ["SORRY","I’M SORRY","MY APOLOGIES"] },
    { ko: "축하해", en: ["CONGRATS","CONGRATULATIONS","WELL DONE"] },
    { ko: "잘했어", en: ["WELL DONE","GOOD JOB","NICE WORK"] },
    { ko: "힘내", en: ["CHEER UP","YOU’VE GOT THIS","HANG IN THERE"] },
    { ko: "안녕", en: ["HELLO","HI","BYE"] }
  ];
  const POPULAR = ["IT’S OKAY","THANK YOU","I LOVE YOU","SORRY","CONGRATS","CHEER UP","WELL DONE"];

  function isHangulSyllable(ch){
    const code = ch.charCodeAt(0);
    return code >= 0xAC00 && code <= 0xD7A3;
  }

  function romanizeKo(text){
    // override for common exact matches
    const t = text.trim();
    if (PREFERRED[t]) return PREFERRED[t];
    const parts = [];
    for (let i=0;i<t.length;i++){
      const ch = t[i];
      if (isHangulSyllable(ch)){
        const code = ch.charCodeAt(0) - 0xAC00;
        const ci = Math.floor(code / 588);
        const vi = Math.floor((code % 588) / 28);
        const fi = code % 28;
        const r = CHO[ci] + JUNG[vi] + JONG[fi];
        parts.push(r);
      } else if (ch === ' '){
        parts.push(' ');
      } else {
        parts.push(ch);
      }
    }
    // join with NB hyphen within words
    let out = "";
    let buf = [];
    for (const p of parts){
      if (p === ' '){
        if (buf.length){ out += buf.join(nonbreak); buf = []; }
        out += ' ';
      } else {
        buf.push(p);
      }
    }
    if (buf.length){ out += buf.join(nonbreak); }
    return out.replace(/-/g, nonbreak);
  }

  function buildUrl(){
    const base = $('#base').value.trim() || 'https://inspire-wood.github.io/its-okay/';
    const ko = $('#ko').value.trim();
    const roman = $('#roman').value.trim();
    const en = $('#en').value.trim();
    const params = new URLSearchParams();
    if (ko) params.set('ko', ko);
    if (roman) params.set('roman', roman);
    if (en) params.set('en', en);
    const url = base.replace(/\/+$/, '/') + (params.toString() ? ('?' + params.toString()) : '');
    $('#out').textContent = url;
    $('#open').href = url;
    const enc = encodeURIComponent(url);
    const qrsrc = 'https://quickchart.io/qr?text='+enc+'&size=480&margin=2';
    $('#qr').src = qrsrc;
    $('#download').href = qrsrc;
    localStorage.setItem('linkmakerPRO', JSON.stringify({base, ko, roman, en, auto: $('#auto').checked}));
    return url;
  }

  function refreshSuggest(){
    const ko = $('#ko').value.trim();
    const list = $('#suggestList');
    list.innerHTML = '';
    let items = [];
    if (ko){
      // exact first
      for (const row of SUGG){
        if (row.ko === ko) items = items.concat(row.en);
      }
      // contains fallback
      if (items.length === 0){
        for (const row of SUGG){
          if (ko.includes(row.ko)) items = items.concat(row.en);
        }
      }
    }
    if (items.length === 0) items = POPULAR;
    // unique
    items = [...new Set(items)];
    for (const it of items){
      const btn = document.createElement('button');
      btn.className = 'item';
      btn.textContent = it;
      btn.addEventListener('click', ()=>{
        $('#en').value = it;
        buildUrl();
      });
      list.appendChild(btn);
    }
  }

  function applyAutoRoman(){
    const auto = $('#auto').checked;
    if (!auto) return;
    const ko = $('#ko').value.trim();
    if (!ko){ $('#roman').value = ''; return; }
    const r = romanizeKo(ko);
    $('#roman').value = r;
  }

  // Wire up
  $('#build').addEventListener('click', buildUrl);
  $('#copy').addEventListener('click', async ()=>{
    const url = buildUrl();
    try { await navigator.clipboard.writeText(url); alert('복사됨'); }
    catch(e){ prompt('복사가 불가한 환경입니다. 수동 복사:', url); }
  });
  $('#open').addEventListener('click', buildUrl);
  $('#download').addEventListener('click', buildUrl);
  $('#refresh').addEventListener('click', buildUrl);
  $('#toupper').addEventListener('click', ()=>{ $('#en').value = $('#en').value.toUpperCase(); buildUrl(); });
  $('#reset').addEventListener('click', ()=>{ $('#base').value = 'https://inspire-wood.github.io/its-okay/'; buildUrl(); });
  $('#refreshSuggest').addEventListener('click', refreshSuggest);
  $('#auto').addEventListener('change', ()=>{ applyAutoRoman(); buildUrl(); });

  // Respond as user types
  $('#ko').addEventListener('input', ()=>{ applyAutoRoman(); refreshSuggest(); buildUrl(); });
  $('#roman').addEventListener('input', ()=>{ if ($('#auto').checked){ /* user overrides but auto on */ } buildUrl(); });
  $('#en').addEventListener('input', buildUrl);
  $('#base').addEventListener('input', buildUrl);

  // load state
  try{
    const saved = JSON.parse(localStorage.getItem('linkmakerPRO')||'{}');
    if (saved.base) $('#base').value = saved.base;
    if (saved.ko) $('#ko').value = saved.ko;
    if (saved.roman) $('#roman').value = saved.roman;
    if (saved.en) $('#en').value = saved.en;
    if (typeof saved.auto === 'boolean') $('#auto').checked = saved.auto;
  }catch(e){}
  applyAutoRoman();
  refreshSuggest();
  buildUrl();
</script>
</body>
</html>
